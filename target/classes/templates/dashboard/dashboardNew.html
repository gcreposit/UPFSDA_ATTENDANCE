<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/layout :: head}">
    <title>Admin Dashboard - UPFSDA Attendance System</title>

</head>

<body>
<nav th:replace="~{fragments/layout :: sidebar}"></nav>
<header th:replace="~{fragments/layout :: header}"></header>

<main class="main-content">
    <div class="dashboard-grid-admin">

        <div class="dashboard-center">
            <div class="welcome-card">
                <div class="welcome-content">
                    <h3>Admin Dashboard</h3>
                    <p>Here's the attendance overview for today.</p>
                    <small th:text="'Today is ' + ${#dates.format(#dates.createNow(), 'EEEE, MMMM dd, yyyy')}"></small>
                </div>
                <div class="welcome-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
            </div>

            <div class="dashboard-main">
<!--                &lt;!&ndash; Summary Cards Section &ndash;&gt;-->
<!--                <div class="stats-section">-->

<!--                    &lt;!&ndash; Total Employees &ndash;&gt;-->
<!--                    <div class="stat-card-small" onclick="goToDetails('total_employees')">-->
<!--                        <div class="stat-icon" style="background:#007bff"><i class="fas fa-users"></i></div>-->
<!--                        <div class="stat-content">-->
<!--                            <div class="stat-title">Total Employees</div>-->
<!--                            <div class="stat-value" id="totalEmployeesCount">0</div>-->
<!--                        </div>-->
<!--                    </div>-->

<!--                    &lt;!&ndash; Present Card with Breakdown Inside &ndash;&gt;-->
<!--                    <div class="stat-card-small" style="flex: 1;">-->
<!--                        <div class="stat-icon" style="background:#28a745"><i class="fas fa-user-check"></i></div>-->
<!--                        <div class="stat-content" style="width: 100%;">-->
<!--                            <div class="stat-title" onclick="goToDetails('today_present')" style="cursor: pointer;">Present</div>-->
<!--                            <div class="stat-value" id="presentCount" onclick="goToDetails('today_present')" style="cursor: pointer;">0</div>-->

<!--                            &lt;!&ndash; Attendance Type Breakdown &ndash;&gt;-->
<!--                            <div style="margin-top: 8px; font-size: 0.85rem; color: #555;">-->
<!--                                <strong>Attendance Type</strong>-->
<!--                                <div style="display: flex; justify-content: space-between; cursor: pointer;" onclick="goToDetails('on_time')">-->
<!--                                    <span>On Time:</span> <span id="onTimeCount">0</span>-->
<!--                                </div>-->
<!--                                <div style="display: flex; justify-content: space-between; cursor: pointer;" onclick="goToDetails('late_entry')">-->
<!--                                    <span>Late Entry:</span> <span id="lateEntryCount">0</span>-->
<!--                                </div>-->
<!--                                <div style="display: flex; justify-content: space-between; cursor: pointer;" onclick="goToDetails('late_and_half')">-->
<!--                                    <span>Late & Half Day:</span> <span id="lateAndHalfCount">0</span>-->
<!--                                </div>-->
<!--                            </div>-->

<!--                            &lt;!&ndash; Work Mode Breakdown &ndash;&gt;-->
<!--                            <div style="margin-top: 8px; font-size: 0.85rem; color: #555;">-->
<!--                                <strong>Work Mode</strong>-->
<!--                                <div style="display: flex; justify-content: space-between; cursor: pointer;" onclick="goToDetails('wfo')">-->
<!--                                    <span>Work From Office:</span> <span id="wfoCount">0</span>-->
<!--                                </div>-->
<!--                                <div style="display: flex; justify-content: space-between; cursor: pointer;" onclick="goToDetails('wfh')">-->
<!--                                    <span>Work From Home:</span> <span id="wfhCount">0</span>-->
<!--                                </div>-->
<!--                                <div style="display: flex; justify-content: space-between; cursor: pointer;" onclick="goToDetails('wff')">-->
<!--                                    <span>Work From Field:</span> <span id="wffCount">0</span>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->

<!--                    &lt;!&ndash; Absent &ndash;&gt;-->
<!--                    <div class="stat-card-small" onclick="goToDetails('absent')">-->
<!--                        <div class="stat-icon" style="background:#dc3545"><i class="fas fa-user-times"></i></div>-->
<!--                        <div class="stat-content">-->
<!--                            <div class="stat-title">Absent</div>-->
<!--                            <div class="stat-value" id="absentCount">0</div>-->
<!--                        </div>-->
<!--                    </div>-->

<!--                    &lt;!&ndash; Half Day &ndash;&gt;-->
<!--                    <div class="stat-card-small" onclick="goToDetails('half_day')">-->
<!--                        <div class="stat-icon" style="background-color: #ff9800;">-->
<!--                            <i class="fas fa-user-slash"></i>-->
<!--                        </div>-->
<!--                        <div class="stat-content">-->
<!--                            <div class="stat-title">Half Day</div>-->
<!--                            <div class="stat-value" id="halfDayCount">0</div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->


                <!-- Summary Cards Section -->
                <div class="stats-section">

                    <!-- Total Employees -->
                    <div class="stat-card-small" onclick="goToDetails('total_employees')" style="background: linear-gradient(145deg, #00b3b3, #009999)">
                        <div class="stat-icon"><i class="fas fa-users"></i></div>
                        <div class="stat-content">
                            <div class="stat-title">Total Employees</div>
                            <div class="stat-value" id="totalEmployeesCount">0</div>
                        </div>
                    </div>

                    <!-- Present Card with Breakdown Inside -->
                    <div class="stat-card-large" style="background: linear-gradient(145deg, #28a745, #218838);" onclick="goToDetails('today_present')">
                        <div class="stat-icon"><i class="fas fa-user-check"></i></div>
                        <div class="stat-content">
                            <div class="stat-title">Present</div>
                            <div class="stat-value" id="presentCount">0</div>

                            <!-- Attendance Type Breakdown -->
                            <div class="stat-breakdown">
                                <strong>Attendance Type</strong>
                                <div class="breakdown-item" onclick="event.stopPropagation(); goToDetails('on_time')">
                                    <span>On Time:</span> <span id="onTimeCount">0</span>
                                </div>
                                <div class="breakdown-item" onclick="event.stopPropagation(); goToDetails('late_entry')">
                                    <span>Late Entry:</span> <span id="lateEntryCount">0</span>
                                </div>
                                <div class="breakdown-item" onclick="event.stopPropagation(); goToDetails('late_and_half')">
                                    <span>Late & Half Day:</span> <span id="lateAndHalfCount">0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Work Mode Card -->
                    <div class="stat-card-large" style="background: linear-gradient(145deg, #3f51b5, #303f9f);">
                        <div class="stat-icon"><i class="fas fa-briefcase"></i></div>
                        <div class="stat-content">
                            <div class="stat-title">Work Mode</div>

                            <!-- Work Mode Breakdown -->
                            <div class="stat-breakdown">
                                <div class="breakdown-item" onclick="goToDetails('wfo')">
                                    <span>Work From Office:</span> <span id="wfoCount">0</span>
                                </div>
                                <div class="breakdown-item" onclick="goToDetails('wfh')">
                                    <span>Work From Home:</span> <span id="wfhCount">0</span>
                                </div>
                                <div class="breakdown-item" onclick="goToDetails('wff')">
                                    <span>Work From Field:</span> <span id="wffCount">0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Absent -->
                    <div class="stat-card-small" onclick="goToDetails('absent')" style="background: linear-gradient(145deg, #ff4444, #d40000)">
                        <div class="stat-icon"><i class="fas fa-user-times"></i></div>
                        <div class="stat-content">
                            <div class="stat-title">Absent</div>
                            <div class="stat-value" id="absentCount">0</div>
                        </div>
                    </div>

                    <!-- Half Day -->
                    <div class="stat-card-small" onclick="goToDetails('half_day')" style="background: linear-gradient(145deg, #ff9800, #e68900)">
                        <div class="stat-icon"><i class="fas fa-user-slash"></i></div>
                        <div class="stat-content">
                            <div class="stat-title">Half Day</div>
                            <div class="stat-value" id="halfDayCount">0</div>
                        </div>
                    </div>

                </div>


                <!-- Chart Section -->
                <div class="chart-section">
                    <h4>Attendance Status Distribution</h4>
                    <canvas id="attendancePieChart" width="300" height="300"></canvas>
                </div>
            </div>

        </div>

        <div class="dashboard-right">
            <div class="simple-calendar-card">
                <div class="simple-calendar-header">
                    <button class="simple-nav" id="simplePrevMonth"><i class="fas fa-chevron-left"></i></button>
                    <span class="simple-month-year" id="simpleCurrentMonth">August 2025</span>
                    <button class="simple-nav" id="simpleNextMonth"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div class="simple-calendar-grid" id="simpleCalendarGrid"></div>
            </div>
        </div>
    </div>
</main>

<footer th:replace="~{fragments/layout :: footer}"></footer>
<div th:replace="~{fragments/layout :: scripts}"></div>

<!-- Chart.js Library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        loadAdminDashboardData();
        initializeCalendar();
    });

    function goToDetails(type) {

        window.location.href = `/attendance/attendance-details?type=${type}`;

    }

    let attendancePieChart = null; // store chart instance

    async function loadAdminDashboardData() {
        try {
            const response = await fetch('/api/data/dashboard-stats-admin');
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const apiResponse = await response.json();

            if (apiResponse.statusCode === 200 && apiResponse.data) {
                updateDashboardStats(apiResponse.data);
            } else {
                console.warn('API returned no data:', apiResponse.message);
            }
        } catch (error) {
            console.error('Error loading admin dashboard data:', error);
            // alert('Failed to load dashboard data. Please try again later.');
        }
    }

    function updateDashboardStats(data) {
        document.getElementById('totalEmployeesCount').textContent = data.total_employees || 0;
        document.getElementById('onTimeCount').textContent = data.on_time || 0;
        document.getElementById('lateEntryCount').textContent = data.late_entry || 0;
        document.getElementById('absentCount').textContent = data.absent_today || 0;
        document.getElementById('halfDayCount').textContent = data.half_day || 0;
        document.getElementById('lateAndHalfCount').textContent = data.late_and_half || 0;
        document.getElementById('wfoCount').textContent = data.total_work_from_office || 0;
        document.getElementById('wfhCount').textContent = data.total_work_from_home || 0;
        document.getElementById('wffCount').textContent = data.total_work_from_field || 0;
        document.getElementById('presentCount').textContent = data.present_today || 0;

        // Prepare pie chart data
        const chartData = [
            data.on_time || 0,
            data.late_entry || 0,
            data.absent_today || 0,
            data.half_day || 0,
            data.late_and_half || 0
        ];

        const chartLabels = ['On Time', 'Late Entry', 'Absent', 'Half Day', 'Late & Half Day'];
        const chartColors = ['#4caf50', '#ff9800', '#f44336', '#2196f3', '#9c27b0'];

        // Destroy previous chart instance if exists
        if (attendancePieChart) attendancePieChart.destroy();

        // Create chart
        const ctx = document.getElementById('attendancePieChart').getContext('2d');
        attendancePieChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: chartLabels,
                datasets: [{
                    label: 'Attendance Overview',
                    data: chartData,
                    backgroundColor: chartColors,
                    borderColor: '#fff',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {position: 'bottom'},
                    tooltip: {enabled: true}
                }
            }
        });
    }

    function initializeCalendar() {
        const currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();

        document.getElementById('simplePrevMonth').addEventListener('click', () => {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderSimpleCalendar();
        });

        document.getElementById('simpleNextMonth').addEventListener('click', () => {
            console.log("Clicked")
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderSimpleCalendar();

        });

        function renderSimpleCalendar() {
            console.log('clicked 1')
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            const weekdays = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];

            document.getElementById('simpleCurrentMonth').textContent = `${monthNames[currentMonth]} ${currentYear}`;
            const calendarGrid = document.getElementById('simpleCalendarGrid');

            calendarGrid.innerHTML = '';

            weekdays.forEach(day => {
                const dayElement = document.createElement('div');
                dayElement.className = 'simple-weekday';
                dayElement.textContent = day;
                calendarGrid.appendChild(dayElement);
            });

            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

            for (let i = 0; i < firstDay; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'simple-day other-month';
                calendarGrid.appendChild(dayElement);
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'simple-day';
                dayElement.textContent = day;
                if (currentYear === currentDate.getFullYear() &&
                    currentMonth === currentDate.getMonth() &&
                    day === currentDate.getDate()) {
                    dayElement.classList.add('today');
                }
                calendarGrid.appendChild(dayElement);
            }
        }

        renderSimpleCalendar();
    }
</script>
</body>
</html>
